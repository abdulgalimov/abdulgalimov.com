---
title: Export images
date: 2016-12-18 00:04:52
tags:
category: convert
---

Я очень долго занимался разработкой на Flash, сделано много проектов на флеше. Теперь возникла необходимость переделать флешь игры на JavaScript. Блог посвящен разработке на JS, поэтому очень хочется приступить к написанию статей посвященных именно ему. Но я все таки решил сперва рассказать как конвертировать существующий flash-контент в JS формат, чтобы нам было с чем работать :). Конвертирование контента может происходить в несколько этапов, и выполняется разными способами, в зависимости от того, что вы конвертируете: картинки, анимации, звуки... В этой статье я расскажу как можно извлечь изображения из .fla файла и скомпилированного .swf.

<!-- more -->

## Экспорт из .fla
Конечно вы можете экспортировать каждый файл руками, но мы же программисты, поэтому будем писать для этого скрипты. К тому жее когда контента много - скрипт, это единственное разумное решение. Здесь [Пишем jsfl-скрипт для экспорта изображений из FLA](http://flashpress.ru/blog/jsfl-export-images/) отличная статья на тему как написать скрипт JSFL для экспорта всех изображений из Adobe Animate. Там вы найдете подробную инструкцию как написать скрипт, и готовый JSFL файл, который умеет экспортировать файлы по правилам заданным конфиг-файле. Я не буду здесь подробно останавливаться на этом, если у вас возникнут какие либо сложности со скриптом, спрашивайте в комментариях, попробуем решить вместе.

## Экспорт из swf
Когда проект живет очень долго, к сожалению иногда случаются печальки, и исходники могут быть утеряны. Так вот если у вас нет исходного .fla файла с изображениями, и вам необходимо вытащить все картинки из скомпилированного swf файла - не расстраивайтесь, проблема решаема. Есть два способа вытащить изображения из swf файла:
1. Экспорт средствами ActionScript
2. Декомпиляция + экспорт из .fla

### Экспорт средствами ActionScript
Ресурс посвящен JavaScript разработке, поэтому я не буду подробно рассказывать как это сделать, дам только подсказку, ну а дальше сами :) в случае проблем - спрашивайте в комментариях. Вам необходимо загрузить флешку, получить список всех внутренних классов методом:
```ActionScript
var classesList:Vector.<String> = loaderInfo.applicationDomain.getQualifiedDefinitionNames();
```
Далее можно пройтись по всем именам классов, создать эксземпляр и проверить, если это BitmapData - сделать экспорт:
```ActionScript
var bytes:ByteArray = bitmapData.encode(new Rectangle(0, 0, bitmapData.width, bitmapData.height), new PNGEncoderOptions());
new FileReference().save(bytes);
```

Если же внутри swf лежит MovieClip или Sprite со сложной графикой внутри, и необходимо этот мувик(спрайт) экспортировать в png целиком: вы можете отрисовать этот клип в BitmapData и сохранить как показано выше. Только здесь есть один нюанс, если у вашего MovieClip/Sprite начало координат смещено относительно левого верхнего угла, тогда вам перед отрисовкой в BitmapData необходимо вычислить смещение и применить его в методе .draw. Допустим у нас есть вот такой мувиклип: 
![](/images/Export images/export_arrow.png "arrow image")
Красным крестом показана точка начала координат мувика(спрайта). Как правильно экспортировать такой мувик:

```ActionScript
var clip:MovieClip = new myArrowClip();
// Для начала необходимо положить клип на stage в координаты 0.0
stage.addChild(clip);
clip.x = 0; clip.y = 0;
// вычисляем смещение
var bounds:Rectangle = clip.getBounds(stage);
var matrix:Matrix = new Matrix();
matrix.translate(-bounds.x, -bounds.y);
//
var bitmapData:BitmapData = new BitmapData(clip.width, clip.height, true, 0x00000000);
bitmapData.draw(clip, matrix);
```